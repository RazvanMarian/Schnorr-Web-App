@using LicentaWebApp.Shared.Models
@using System.Threading
@inject IDialogService _dialogService


<MudMenu MaxHeight="300" AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter">
    <ActivatorContent>
        <MudBadge Overlap="true" Content="NotificationsNumber" Color="Color.Primary">
            <MudIconButton Icon="@Icons.Material.Outlined.Notifications"></MudIconButton>
        </MudBadge>
    </ActivatorContent>

    <ChildContent>
        @foreach (var notification in Notifications)
        {
            <MudMenuItem OnClick="@(_ => OpenNotification(@notification))" Style="max-width: 240px">
                <MudCard>
                    <MudCardContent>
                        <MudText>@notification.InitiatorFirstName @notification.InitiatorLastName sent you a signature request</MudText>
                        <MudText Typo="Typo.body2">@notification.FileName</MudText>
                    </MudCardContent>
                    <MudCardActions>
                        <MudText>Created at: @notification.CreatedAt</MudText>
                    </MudCardActions>
                </MudCard>
            </MudMenuItem>
            <MudDivider/>
        }
    </ChildContent>
</MudMenu>


@code{
    private bool _isOpen = false;

    [Parameter]
    public int NotificationsNumber { get; set; }

    [Parameter]
    public List<Notification> Notifications { get; set; } = new();

    private void ToggleOpen()
    {
        _isOpen = !_isOpen;
    }


    private void OpenNotification(Notification notification)
    {
        DialogOptions dialogOptions = new DialogOptions();
        dialogOptions.FullWidth = true;
        dialogOptions.CloseButton = true;
        dialogOptions.NoHeader = false;
        var parameters = new DialogParameters {["Note"] = notification};
        _dialogService.Show<NotificationDialog>($"Request created at: {notification.CreatedAt}", parameters, dialogOptions);
        StateHasChanged();
    }

}